<div class="create-publication-pages">
  <div class="form-card">
    <div class="header">
      <div class="title-area">
        <h1>{{ isEditMode ? ('create.edit' | translate) : ('create.new' | translate) }}</h1>
        <p class="subtitle">{{ 'create.subtitle' | translate }}</p>
      </div>
      <a routerLink="/board" class="btn-close" title="Fermer"><i class="fas fa-times"></i></a>
    </div>

    <!-- Feedback Messages -->
    <div *ngIf="errorMessage" class="alert alert-danger animate-in">
      <i class="fas fa-exclamation-circle"></i> {{ errorMessage }}
    </div>
    <div *ngIf="successMessage" class="alert alert-success animate-in">
      <i class="fas fa-check-circle"></i> {{ successMessage }}
    </div>

    <form class="publication-form" [formGroup]="publicationForm" (ngSubmit)="onSubmit()">
      
      <!-- General Info Section -->
      <div class="form-section">
        <h3><i class="fas fa-info-circle"></i> {{ 'create.generalInfo' | translate }}</h3>
        <div class="grid-container">
          <div class="form-group full-width">
            <label for="title">{{ 'create.titleLabel' | translate }}</label>
            <input type="text" id="title" formControlName="title" [placeholder]="'create.titlePlaceholder' | translate">
            <div *ngIf="publicationForm.get('title')?.touched && publicationForm.get('title')?.invalid" class="error">
              {{ 'create.errTitle' | translate }}
            </div>
          </div>

          <div class="form-group">
            <label for="type">{{ 'create.type' | translate }}</label>
            <select id="type" formControlName="type">
              <option value="">{{ 'create.typeSelect' | translate }}</option>
              <option value="publi">{{ 'create.typeReportage' | translate }}</option>
              <option value="agro">{{ 'create.typeAgro' | translate }}</option>
            </select>
            <div *ngIf="publicationForm.get('type')?.touched && publicationForm.get('type')?.invalid" class="error">
              {{ 'create.errType' | translate }}
            </div>
          </div>

          <div class="form-group">
            <label for="date">{{ 'create.date' | translate }}</label>
            <input type="date" id="date" formControlName="date">
            <div *ngIf="publicationForm.get('date')?.touched && publicationForm.get('date')?.invalid" class="error">
              {{ 'create.errDate' | translate }}
            </div>
          </div>

          <div class="form-group full-width">
            <label for="location">{{ 'create.location' | translate }}</label>
            <input type="text" id="location" formControlName="location" [placeholder]="'create.locationPlaceholder' | translate">
            <div *ngIf="publicationForm.get('location')?.touched && publicationForm.get('location')?.invalid" class="error">
              {{ 'create.errLocation' | translate }}
            </div>
          </div>
        </div>
      </div>

      <!-- Content Section -->
      <div class="form-section">
        <h3><i class="fas fa-pen"></i> {{ 'create.content' | translate }}</h3>
        <div class="form-group">
          <label for="description">{{ 'create.summary' | translate }}</label>
          <textarea id="description" formControlName="description" rows="2" [placeholder]="'create.summaryPlaceholder' | translate"></textarea>
          <div *ngIf="publicationForm.get('description')?.touched && publicationForm.get('description')?.invalid" class="error">
            {{ 'create.errSummary' | translate }}
          </div>
        </div>

        <div class="form-group">
          <label for="content">{{ 'create.body' | translate }}</label>
          <textarea id="content" formControlName="content" rows="10" [placeholder]="'create.bodyPlaceholder' | translate"></textarea>
          <div *ngIf="publicationForm.get('content')?.touched && publicationForm.get('content')?.invalid" class="error">
            {{ 'create.errContent' | translate }}
          </div>
        </div>
      </div>

      <!-- Media Section -->
      <div class="form-section">
        <h3><i class="fas fa-camera"></i> {{ 'create.media' | translate }}</h3>
        <div class="upload-area" [class.has-files]="imagePreviews.length > 0"
             (dragover)="onDragOver($event)" (drop)="onDrop($event)">
          <input type="file" id="photos" (change)="onFileSelected($event)" accept="image/*" multiple hidden #fileInput>
          <div class="upload-placeholder" (click)="fileInput.click()">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>{{ 'create.upload' | translate }}</p>
            <span>{{ 'create.uploadFormats' | translate }}</span>
          </div>
        </div>
        <!-- Image Previews -->
        <div class="image-previews" *ngIf="imagePreviews.length > 0">
          <div class="preview-item" *ngFor="let preview of imagePreviews; let i = index">
            <img [src]="preview" alt="Preview">
            <button type="button" class="remove-preview" (click)="removePreview(i)">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        <div *ngIf="publicationForm.get('photos')?.touched && publicationForm.get('photos')?.invalid" class="error">
          <small *ngIf="publicationForm.get('photos')?.errors?.['required']">{{ 'create.errPhotoReq' | translate }}</small>
          <small *ngIf="publicationForm.get('photos')?.errors?.['maxFilesExceeded']">{{ 'create.errPhotoMax' | translate }}</small>
        </div>
      </div>

      <!-- Submit Section -->
      <div class="form-actions">
        <button type="button" class="btn btn-ghost" routerLink="/board">{{ 'create.cancel' | translate }}</button>
        <button type="submit" class="btn btn-primary" [disabled]="isLoading" (click)="onSubmit($event)">
          <span *ngIf="!isLoading">
            <i class="fas" [class.fa-plus]="!isEditMode" [class.fa-save]="isEditMode"></i>
            {{ isEditMode ? ('create.save' | translate) : ('create.publish' | translate) }}
          </span>
          <span *ngIf="isLoading"><i class="fas fa-spinner fa-spin"></i> {{ 'create.processing' | translate }}</span>
        </button>
      </div>
    </form>
  </div>
</div>
